(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[702],{3416:function(e,l,s){Promise.resolve().then(s.bind(s,1720))},1720:function(e,l,s){"use strict";s.r(l),s.d(l,{default:function(){return r}});var a=s(7437),t=s(2265),n=s(6705),i=s(4084);function r(){var e,l,s,i;let[r,d]=(0,t.useState)([]),[o,x]=(0,t.useState)(null),[h,m]=(0,t.useState)(!0),[u,g]=(0,t.useState)({listingId:"all",channel:"all",minRating:0,sentiment:"all",source:"all"});(0,t.useEffect)(()=>{!async function(){m(!0);let e=await fetch("/api/reviews/hostaway?summary=1",{cache:"no-store"}),l=await e.json();d(l.reviews||[]),x(l.summary||null),m(!1)}()},[]);let p=(0,t.useMemo)(()=>Array.from(new Set(r.map(e=>"".concat(e.listingId,":::").concat(e.listingName)))).map(e=>({id:Number(e.split(":::")[0]),name:e.split(":::")[1]})),[r]),v=(0,t.useMemo)(()=>r.filter(e=>{var l;return("all"===u.listingId||String(e.listingId)===u.listingId)&&("all"===u.channel||e.channel===u.channel)&&("all"===u.source||e.source===u.source)&&(!u.minRating||!((null!==(l=e.rating)&&void 0!==l?l:0)<u.minRating))&&("all"===u.sentiment||e.sentiment.label===u.sentiment)}),[r,u]),j=(0,t.useMemo)(()=>{let e={};for(let l of v){let s=new Date(l.publishedAt),a="".concat(s.getUTCFullYear(),"-").concat(String(s.getUTCMonth()+1).padStart(2,"0"));e[a]||(e[a]=[]),null!=l.rating&&e[a].push(l.rating)}let l=Object.keys(e).sort(),s=l.map(l=>{let s=e[l];return s.length?Math.round(s.reduce((e,l)=>e+l,0)/s.length*100)/100:null});return{labels:l,data:s}},[v]);async function N(e,l){await fetch("/api/reviews/approve",{method:"PATCH",body:JSON.stringify({id:e,approved:l})}),d(s=>s.map(s=>s.id===e?{...s,approved:l}:s))}return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("h1",{className:"text-2xl font-semibold",children:"Manager Dashboard"}),h?(0,a.jsx)("div",{className:"card",children:"Loading reviews…"}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("section",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,a.jsx)(c,{title:"Total reviews",value:null!==(e=null==o?void 0:o.overall.total)&&void 0!==e?e:v.length}),(0,a.jsx)(c,{title:"Avg rating",value:(null!==(l=null==o?void 0:o.overall.avgRating)&&void 0!==l?l:0).toFixed(2)}),(0,a.jsx)(c,{title:"Positive %",value:(null!==(s=null==o?void 0:o.overall.posPct)&&void 0!==s?s:0)+"%"}),(0,a.jsx)(c,{title:"Negative %",value:(null!==(i=null==o?void 0:o.overall.negPct)&&void 0!==i?i:0)+"%"})]}),(0,a.jsx)("section",{className:"card space-y-4",children:(0,a.jsxs)("div",{className:"flex flex-wrap gap-3 items-end",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs text-slate-400",children:"Listing"}),(0,a.jsxs)("select",{className:"bg-slate-800 border border-slate-700 rounded px-2 py-1",value:u.listingId,onChange:e=>g(l=>({...l,listingId:e.target.value})),children:[(0,a.jsx)("option",{value:"all",children:"All"}),p.map(e=>(0,a.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs text-slate-400",children:"Channel"}),(0,a.jsxs)("select",{className:"bg-slate-800 border border-slate-700 rounded px-2 py-1",value:u.channel,onChange:e=>g(l=>({...l,channel:e.target.value})),children:[(0,a.jsx)("option",{value:"all",children:"All"}),Array.from(new Set(r.map(e=>e.channel))).map(e=>(0,a.jsx)("option",{value:e,children:e},e))]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs text-slate-400",children:"Source"}),(0,a.jsxs)("select",{className:"bg-slate-800 border border-slate-700 rounded px-2 py-1",value:u.source,onChange:e=>g(l=>({...l,source:e.target.value})),children:[(0,a.jsx)("option",{value:"all",children:"All"}),(0,a.jsx)("option",{value:"hostaway",children:"Hostaway"}),(0,a.jsx)("option",{value:"google",children:"Google"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs text-slate-400",children:"Min rating"}),(0,a.jsx)("input",{type:"number",step:"0.5",min:"0",max:"5",className:"w-24 bg-slate-800 border border-slate-700 rounded px-2 py-1",value:u.minRating,onChange:e=>g(l=>({...l,minRating:Number(e.target.value)}))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs text-slate-400",children:"Sentiment"}),(0,a.jsxs)("select",{className:"bg-slate-800 border border-slate-700 rounded px-2 py-1",value:u.sentiment,onChange:e=>g(l=>({...l,sentiment:e.target.value})),children:[(0,a.jsx)("option",{value:"all",children:"All"}),(0,a.jsx)("option",{value:"positive",children:"Positive"}),(0,a.jsx)("option",{value:"neutral",children:"Neutral"}),(0,a.jsx)("option",{value:"negative",children:"Negative"})]})]})]})}),(0,a.jsxs)("section",{className:"card",children:[(0,a.jsx)("h2",{className:"font-medium mb-4",children:"Trend — Avg rating by month"}),(0,a.jsx)(n.x1,{data:{labels:j.labels,datasets:[{label:"Avg rating",data:j.data}]},options:{responsive:!0,scales:{y:{suggestedMin:1,suggestedMax:5}}}})]}),(0,a.jsxs)("section",{className:"card",children:[(0,a.jsx)("h2",{className:"font-medium mb-4",children:"Reviews"}),(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full text-sm",children:[(0,a.jsx)("thead",{className:"text-slate-400 border-b border-slate-700",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"text-left py-2",children:"Date"}),(0,a.jsx)("th",{className:"text-left",children:"Listing"}),(0,a.jsx)("th",{className:"text-left",children:"Channel"}),(0,a.jsx)("th",{className:"text-left",children:"Rating"}),(0,a.jsx)("th",{className:"text-left",children:"Sentiment"}),(0,a.jsx)("th",{className:"text-left",children:"Categories"}),(0,a.jsx)("th",{className:"text-left",children:"Text"}),(0,a.jsx)("th",{className:"text-left",children:"Approved"})]})}),(0,a.jsx)("tbody",{className:"divide-y divide-slate-800/70",children:v.map(e=>{var l;return(0,a.jsxs)("tr",{className:"align-top",children:[(0,a.jsx)("td",{className:"py-3 whitespace-nowrap",children:new Date(e.publishedAt).toLocaleDateString()}),(0,a.jsx)("td",{className:"whitespace-nowrap",children:(0,a.jsx)("a",{href:"/properties/".concat(e.listingId),className:"hover:underline",children:e.listingName})}),(0,a.jsx)("td",{className:"whitespace-nowrap",children:(0,a.jsx)("span",{className:"badge",children:e.channel})}),(0,a.jsx)("td",{children:null!==(l=e.rating)&&void 0!==l?l:"—"}),(0,a.jsx)("td",{children:(0,a.jsx)("span",{className:"badge",children:e.sentiment.label})}),(0,a.jsx)("td",{className:"max-w-[220px]",children:(0,a.jsx)("div",{className:"flex flex-wrap gap-1",children:e.categories.map(e=>(0,a.jsx)("span",{className:"badge",children:e},e))})}),(0,a.jsx)("td",{className:"max-w-[540px]",children:(0,a.jsx)("p",{className:"text-slate-200 line-clamp-4",children:e.text})}),(0,a.jsx)("td",{children:(0,a.jsxs)("label",{className:"inline-flex items-center gap-2",children:[(0,a.jsx)("input",{type:"checkbox",checked:!!e.approved,onChange:l=>N(e.id,l.currentTarget.checked)}),(0,a.jsx)("span",{className:"text-xs text-slate-400",children:"Show on site"})]})})]},e.id)})})]})})]})]})]})}function c(e){let{title:l,value:s}=e;return(0,a.jsxs)("div",{className:"card",children:[(0,a.jsx)("div",{className:"text-slate-400 text-xs",children:l}),(0,a.jsx)("div",{className:"text-2xl font-semibold mt-1",children:s})]})}i.kL.register(i.uw,i.f$,i.od,i.jn,i.u,i.De)}},function(e){e.O(0,[674,840,971,117,744],function(){return e(e.s=3416)}),_N_E=e.O()}]);