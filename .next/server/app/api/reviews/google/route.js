"use strict";(()=>{var e={};e.id=913,e.ids=[913],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3977:e=>{e.exports=require("node:fs/promises")},9411:e=>{e.exports=require("node:path")},8048:(e,t,n)=>{n.r(t),n.d(t,{originalPathname:()=>b,patchFetch:()=>y,requestAsyncStorage:()=>m,routeModule:()=>f,serverHooks:()=>w,staticGenerationAsyncStorage:()=>v});var i={};n.r(i),n.d(i,{GET:()=>h});var r=n(9303),a=n(8716),o=n(670),l=n(7070),s=n(5327),u=n(3977),g=n.n(u),c=n(9411),p=n.n(c);async function d(){try{let e=await g().readFile(p().join(process.cwd(),"data","approved.json"),"utf-8");return JSON.parse(e)}catch{return{}}}async function h(e){let{searchParams:t}=new URL(e.url),n=process.env.GOOGLE_MAPS_API_KEY,i=t.get("placeId"),r=Number(t.get("listingId")||0),a=t.get("listingName")||`Listing ${r||""}`;if(!n||!i)return l.NextResponse.json({reviews:[],error:"Missing GOOGLE_MAPS_API_KEY or placeId"},{status:200});let o=new URL(`https://places.googleapis.com/v1/places/${i}`);o.searchParams.set("fields","reviews,googleMapsUri,name");try{let e=await fetch(o.toString(),{headers:{"X-Goog-Api-Key":n,"X-Goog-FieldMask":"reviews,googleMapsUri,name"}}),t=await e.json(),i=await d(),u=(t.reviews||[]).slice(0,5).map(e=>(0,s.Uf)(e,r,a,t.googleMapsUri,i));return l.NextResponse.json({reviews:u})}catch(e){return l.NextResponse.json({reviews:[],error:String(e)},{status:200})}}let f=new r.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/reviews/google/route",pathname:"/api/reviews/google",filename:"route",bundlePath:"app/api/reviews/google/route"},resolvedPagePath:"/Users/kvbiila/Downloads/flex-living-reviews-dashboard/app/api/reviews/google/route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:m,staticGenerationAsyncStorage:v,serverHooks:w}=f,b="/api/reviews/google/route";function y(){return(0,o.patchFetch)({serverHooks:w,staticGenerationAsyncStorage:v})}},5327:(e,t,n)=>{n.d(t,{dU:()=>d,Uf:()=>p,T8:()=>c});let i={2005:"Airbnb",2001:"Booking.com",2010:"Vrbo",2007:"Hostaway",2002:"Expedia",2013:"Marriott"},r=e=>e||0===e?i[e]||`Channel ${e}`:"Unknown",a=["great","amazing","awesome","clean","spotless","friendly","helpful","perfect","excellent","fantastic","spacious","cozy","quiet","recommend","comfortable","love"],o=["bad","dirty","smell","noisy","rude","terrible","awful","disappoint","broken","unsafe","issue","problem","bug","delay","poor","worst"];function l(e){let t=(e||"").toLowerCase(),n=0;for(let e of a)t.includes(e)&&(n+=1);for(let e of o)t.includes(e)&&(n-=1);let i=n>0?"positive":n<0?"negative":"neutral";return{score:n,label:i}}let s={Cleanliness:["clean","spotless","dirty","dust","smell","stain"],Communication:["communication","responsive","respond","quick","host"],"Check-in":["check-in","checkin","self check","lockbox","code"],Accuracy:["accurate","exactly as","as described","misleading"],Location:["location","area","neighborhood","central","walk","metro"],Value:["value","price","worth"],Amenities:["amenities","kitchen","coffee","towels","hairdryer","washer","dryer"],Noise:["noise","noisy","quiet","street","traffic"],WiFi:["wifi","wi-fi","internet","speed"],Comfort:["bed","comfortable","mattress","pillow","sofa","shower"],Parking:["parking","garage","park"],Host:["host","helpful","friendly","rude"],Heating:["heating","heater","radiator"],AC:["ac","air conditioning","aircon"],Safety:["safe","unsafe","security"]},u=e=>{if(!e)return new Date(0).toISOString();let t=new Date(e);return isNaN(t.getTime())?new Date(0).toISOString():t.toISOString()},g=e=>null==e?null:Math.round(10*Math.max(1,Math.min(5,Number(e))))/10;function c(e,t){let n=(e.publicReview||e.privateFeedback||"").toString().trim(),i=h(n),a=l(n),o=`hostaway:${e.id}`;return{id:o,source:"hostaway",listingId:e.listingMapId,listingName:e.listingName||`Listing ${e.listingMapId}`,channel:r(e.channelId),reviewType:e.type,status:e.status,rating:g(e.rating),title:null,text:n,language:e.language||null,publishedAt:u(e.departureDate||e.arrivalDate),author:e.guestName||null,categories:i,sentiment:a,approved:!!t[o],url:null}}function p(e,t,n,i,r={}){let a=`google:${e.name||e.reviewId||e.createTime}`,o=e.text?.text||e.text||"",s=h(o),c=l(o);return{id:a,source:"google",listingId:t,listingName:n,channel:"Google",rating:g(e.rating),title:null,text:o,language:e.originalText?.languageCode||e.languageCode||null,publishedAt:u(e.createTime||e.relativePublishTimeDescription),author:e.authorAttribution?.displayName||null,categories:s,sentiment:c,approved:!!r[a],url:e.authorAttribution?.uri||i||null}}function d(e){let t={};for(let n of e){let e=String(n.listingId);t[e]||(t[e]={listingId:n.listingId,listingName:n.listingName,count:0,avgRating:null,posPct:0,negPct:0,latest:null,channels:{},topIssues:[]});let i=t[e];if(i.count+=1,null!=n.rating){let e=(i.avgRating||0)*(i.count-1)+n.rating;i.avgRating=Math.round(e/i.count*100)/100}let r=new Date(n.publishedAt).toISOString();(!i.latest||r>i.latest)&&(i.latest=r),i.channels[n.channel]=(i.channels[n.channel]||0)+1}for(let n of Object.keys(t)){let i={},r=e.filter(e=>String(e.listingId)===n).length,a=0,o=0;for(let t of e.filter(e=>String(e.listingId)===n))for(let e of("positive"===t.sentiment.label&&a++,"negative"===t.sentiment.label&&o++,t.categories))i[e]=(i[e]||0)+1;t[n].posPct=r?Math.round(a/r*100):0,t[n].negPct=r?Math.round(o/r*100):0,t[n].topIssues=Object.entries(i).sort((e,t)=>t[1]-e[1]).slice(0,3).map(([e,t])=>({category:e,count:t}))}let n=e.map(e=>e.rating).filter(e=>null!=e);return{byListing:t,overall:{total:e.length,avgRating:n.length?Math.round(n.reduce((e,t)=>e+t,0)/n.length*100)/100:null,posPct:e.length?Math.round(e.filter(e=>"positive"===e.sentiment.label).length/e.length*100):0,negPct:e.length?Math.round(e.filter(e=>"negative"===e.sentiment.label).length/e.length*100):0}}}function h(e){let t=(e||"").toLowerCase(),n=[];for(let[e,i]of Object.entries(s))i.some(e=>t.includes(e))&&n.push(e);return Array.from(new Set(n))}}};var t=require("../../../../webpack-runtime.js");t.C(e);var n=e=>t(t.s=e),i=t.X(0,[276,972],()=>n(8048));module.exports=i})();